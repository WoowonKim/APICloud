# ë°°í¬ ê°€ì´ë“œ

APICloud ë°°í¬ ê°€ì´ë“œì…ë‹ˆë‹¤.

   <br>

## ğŸ— í”„ë¡œì íŠ¸ ë°°í¬ ê°œìš”

### ê°œìš”

'APICloud'ëŠ” Jenkinsë¥¼ ì´ìš©í•œ CI/CD ìë™í™” í™˜ê²½ìœ¼ë¡œ êµ¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

íŒ€ êµ¬ì„±ì›ì´ ì‘ì—…í•œ ì½”ë“œë¥¼ Gitlabì— Pushí•˜ë©´ Webhookì„ í†µí•´ Jenkins ë¹Œë“œ êµ¬ì„±ì— ë”°ë¼ CI/CD íë¦„ì´ ì§„í–‰ë©ë‹ˆë‹¤.

ğŸ– ì¼ë°˜ ê³„ì •ì—ì„œ ì‹¤í–‰í•  ê²½ìš°, ëª¨ë“  ëª…ë ¹ì–´ ì•ì— 'sudo'ë¥¼ ë¶™ì—¬ì£¼ì„¸ìš”. ë§Œì•½ ì´ ë°©ë²•ì„ ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ 'sudo su'ë¥¼ ì…ë ¥í•˜ì—¬ ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ì§„í–‰í•˜ê¸° ë°”ëë‹ˆë‹¤.

ğŸ‘‰ ë³¸ ë©”ë‰´ì–¼ì—ì„œëŠ” ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ëª…ë ¹ì–´ë¥¼ ì„¤ëª…í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
<br>

### í™˜ê²½ êµ¬ì„± ìˆœì„œ

1. [EC2 ì„¤ì •](#-ec2-ì„¤ì •)
2. [Jenkins ì„¤ì •](#-jenkins-ì„¤ì •)
3. [MySQL ì„¤ì •](#-mysql-ì„¤ì •)
4. [Backend ì„œë²„ ì„¤ì •](#-backend-ì„œë²„-ì„¤ì •)
5. [Frontend ì„œë²„ ì„¤ì •](#-frontend-ì„œë²„-ì„¤ì •)
6. [Nginx, SSL ì„¤ì •](#-nginx,-ssl-ì„¤ì •)

- ê° ë‹¨ê³„ë³„ë¡œ ì„œìˆ í•˜ì˜€ìœ¼ë©°, ìì„¸íˆ ë³´ê¸°ë¥¼ í†µí•´ ìƒì„¸ í™˜ê²½ êµ¬ì„± ê³¼ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Port

í”„ë¡œì íŠ¸ì˜ ê° ì£¼ìš” êµ¬ì„± ìš”ì†Œì˜ í¬íŠ¸ ë²ˆí˜¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

| Port | ì´ë¦„       |
| ---- | ---------- |
| 80   | Nginx      |
| 443  | Https      |
| 3000 | React      |
| 3333 | Node       |
| 3306 | MySQL      |
| 8005 | Springboot |
| 9090 | Jenkins    |

## ğŸ–¥ï¸ EC2 ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/01_EC2_%EC%84%A4%EC%A0%95.md)

## ğŸ‘³ğŸ»â€â™‚ï¸ Jenkins ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/02_Jenkins_%EC%84%A4%EC%A0%95.md)

> ### **Execute Shell**

```bash
//ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì‚­ì œ
docker image prune -a --force

//ë„ì»¤ ì´ë¯¸ì§€ ì••ì¶•íŒŒì¼ì„ ì €ì¥í•  í´ë” ìƒì„±
mkdir -p /var/jenkins_home/images_tar

cd /var/jenkins_home/workspace/ApiCloud/backend/apicloud/
//ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t springboot_deploy .
//ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì••ì¶•í•˜ì—¬ í´ë”ì— ì €ì¥
docker save springboot_deploy > /var/jenkins_home/images_tar/springboot_deploy.tar

cd /var/jenkins_home/workspace/ApiCloud/frontend/
//ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t react_deploy .
//ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì••ì¶•í•˜ì—¬ í´ë”ì— ì €ì¥
docker save react_deploy > /var/jenkins_home/images_tar/react_deploy.tar

ls /var/jenkins_home/images_tar

//tarì„ ì••ì¶• í•´ì œí•˜ì—¬ docker ì´ë¯¸ì§€ë¡œ ë“±ë¡
docker load < /var/jenkins_home/images_tar/springboot_deploy.tar
docker load < /var/jenkins_home/images_tar/react_deploy.tar

//ì»¨í…Œì´ë„ˆê°€ ë™ì‘ì¤‘ì´ë©´ stop
if (docker ps | grep "springboot_deploy"); then docker stop springboot_deploy; fi
if (docker ps | grep "react_deploy"); then docker stop react_deploy; fi

//ì»¨í…Œì´ë„ˆ ìƒì„±í•˜ê¸° í¬íŠ¸ ì—°ê²°
docker run -it -d --rm -p 8005:8005 --name springboot_deploy springboot_deploy
echo "Run springboot_deploy"
docker run -it -d --rm -p 3000:80 --name react_deploy react_deploy
echo "Run react_deploy"
```

## ğŸ¬ MySQL ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/03_MySQL_%EC%84%A4%EC%A0%95.md)

## ğŸ’ Backend ì„œë²„ ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/04_Backend_%EC%84%9C%EB%B2%84_%EC%84%A4%EC%A0%95.md)

> ### **springboot Dockerfile**

```dockerfile
FROM openjdk:11 AS builder
COPY gradlew .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src
ARG DEBIAN_FRONTEND=noninteractive
ENV TZ=Asia/Seoul
RUN chmod =x ./gradlew
RUN ./gradlew bootJar

FROM openjdk:11
COPY --from=builder build/libs/apicloud-0.0.1-SNAPSHOT.jar apicloud.jar

EXPOSE 8005
CMD ["java","-jar","/apicloud.jar"]
```

> ### **Node**

```bash
npm i y-webrtc
```

```shell
sudo PORT=3333 nohup node y-webrtc/node_modules/y-webrtc/bin/server.js &
```

## ğŸ‡ Frontend ì„œë²„ ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/05_Frontend_%EC%84%9C%EB%B2%84_%EC%84%A4%EC%A0%95.md)

> ### **React Dockerfile**

```dockerfile
FROM node:16.15.0 as build-stage
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:stable-alpine
RUN rm -rf /etc/nginx/conf.d/defalut.conf
COPY --from=build-stage /app/nginx/default.conf /etc/nginx/conf.d/default.conf

RUN rm -rf /usr/share/nginx/html/*
COPY --from=build-stage /app/build /usr/share/nginx/html

EXPOSE 80
CMD ["nginx", "-g","daemon off;"]
```

## âš™ Nginx, SSL ì„¤ì •

[ìì„¸íˆë³´ê¸°](/exec/%EB%B0%B0%ED%8F%AC%20%ED%99%98%EA%B2%BD%20%EA%B5%AC%EC%84%B1%20%EC%83%81%EC%84%B8/06_Nginx_SSL_%EC%84%A4%EC%A0%95.md)
